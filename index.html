<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NIGMS Data Science Pathways</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --accent: #582c83;
        --accent-dark: #3c1f59;
        --bg: #f5f2fb;
        --card-bg: #ffffff;
        --text: #1c1c1c;
        --subtle: #5f5f70;
        --border: rgba(88, 44, 131, 0.15);
        font-size: 16px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Space Grotesk", system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", sans-serif;
        background: var(--bg);
        color: var(--text);
        min-height: 100vh;
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background: radial-gradient(
            circle at 20% 20%,
            rgba(88, 44, 131, 0.18),
            transparent 45%
          ),
          radial-gradient(
            circle at 80% 0,
            rgba(26, 188, 156, 0.12),
            transparent 40%
          ),
          radial-gradient(
            circle at 50% 80%,
            rgba(88, 44, 131, 0.14),
            transparent 45%
          );
        z-index: -2;
      }

      header.hero {
        padding: 4rem clamp(1.5rem, 4vw, 6rem);
        background: linear-gradient(135deg, #0b0226, #1a0d3a 55%, #2d174f);
        color: #fff;
        box-shadow: 0 25px 45px rgba(15, 8, 25, 0.35);
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: clamp(2rem, 6vw, 5rem);
        flex-wrap: wrap;
      }

      header.hero::after {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
          circle at 65% 30%,
          rgba(255, 255, 255, 0.25),
          transparent 50%
        );
        pointer-events: none;
      }

      .hero-content {
        position: relative;
        max-width: 640px;
        z-index: 1;
        flex: 1 1 420px;
      }

      .hero-visual {
        flex: 1 1 280px;
        display: flex;
        justify-content: flex-end;
        position: relative;
        z-index: 1;
      }

      .hero-glow {
        width: min(210px, 100%);
        height: auto;
        display: block;
        filter: drop-shadow(0 25px 40px rgba(0, 0, 0, 0.45));
        opacity: 0.95;
      }

      .hero-kicker {
        text-transform: uppercase;
        letter-spacing: 0.2em;
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.7);
        margin-bottom: 1rem;
        display: inline-block;
      }

      h1 {
        margin: 0 0 1rem;
        font-size: clamp(2.8rem, 6vw, 4rem);
      }

      .hero-subtitle {
        margin: 0;
        max-width: 720px;
        font-size: 1.1rem;
        line-height: 1.6;
        color: rgba(255, 255, 255, 0.86);
      }

      main {
        padding: clamp(2rem, 4vw, 4rem);
        max-width: 1200px;
        margin: 0 auto;
      }

      .status-message {
        margin: 4rem auto;
        text-align: center;
        color: var(--subtle);
        font-size: 1.125rem;
      }

      section.pathway {
        margin-bottom: clamp(2rem, 5vw, 4rem);
      }

      section.pathway h2 {
        font-size: clamp(1.8rem, 4vw, 2.4rem);
        margin: 0 0 0.75rem;
        color: var(--accent-dark);
      }

      .pathway-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.4rem;
        margin-bottom: 1.5rem;
      }

      .module-grid {
        display: grid;
        grid-template-columns: repeat(4, minmax(0, 1fr));
        gap: 2rem;
      }

      @media (max-width: 1200px) {
        .module-grid {
          grid-template-columns: repeat(3, minmax(0, 1fr));
        }
      }

      @media (max-width: 900px) {
        .module-grid {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }

      @media (max-width: 600px) {
        .module-grid {
          grid-template-columns: 1fr;
        }
      }

      .module-item {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        align-items: stretch;
        position: relative;
      }

      .module-card {
        width: 100%;
        padding: 0;
        border: none;
        background: transparent;
        font: inherit;
        color: inherit;
        border-radius: 1.5rem;
        cursor: pointer;
        transition: transform 200ms ease, box-shadow 200ms ease;
        box-shadow: 0 18px 45px rgba(15, 8, 25, 0.18);
        overflow: hidden;
        background-color: transparent;
        display: block;
      }

      .module-card:hover,
      .module-card:focus-visible {
        transform: translateY(-6px);
        box-shadow: 0 25px 55px rgba(15, 8, 25, 0.26);
        outline: none;
      }

      .module-card img {
        display: block;
        width: 100%;
        height: auto;
        border-radius: 1.5rem;
      }

      .module-description {
        margin: 0;
        color: var(--subtle);
        font-size: 0.95rem;
        line-height: 1.5;
        max-height: 0;
        opacity: 0;
        overflow: hidden;
        transform: translateY(-0.4rem);
        transition: max-height 260ms ease, opacity 260ms ease,
          transform 260ms ease;
      }

      .module-item:hover .module-description,
      .module-item:focus-within .module-description {
        max-height: 300px;
        opacity: 1;
        transform: translateY(0);
      }

      .skill-pill {
        background: rgba(88, 44, 131, 0.12);
        color: var(--accent-dark);
        padding: 0.3rem 0.75rem;
        border-radius: 999px;
        font-size: 0.75rem;
        font-weight: 500;
      }

      .modal {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 999;
        opacity: 0;
        pointer-events: none;
        transition: opacity 220ms ease;
      }

      .modal.is-visible {
        opacity: 1;
        pointer-events: auto;
      }

      .modal-backdrop {
        position: absolute;
        inset: 0;
        background: rgba(7, 4, 19, 0.75);
        backdrop-filter: blur(4px);
      }

      .modal-dialog {
        position: relative;
        width: min(900px, calc(100% - 2rem));
        max-height: calc(100% - 4rem);
        background: #0e041f;
        color: #fff;
        border-radius: 1.25rem;
        padding: clamp(1.5rem, 3vw, 2.5rem);
        box-shadow: 0 45px 95px rgba(8, 3, 18, 0.7);
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }

      .modal-close {
        position: absolute;
        top: 1rem;
        right: 1rem;
        border: none;
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 999px;
        cursor: pointer;
        font-size: 1.4rem;
        line-height: 1;
        transition: background 180ms ease;
      }

      .modal-close:hover,
      .modal-close:focus-visible {
        background: rgba(255, 255, 255, 0.25);
      }

      .modal-header h3 {
        margin: 0 0 0.5rem;
        font-size: clamp(1.7rem, 4vw, 2.2rem);
      }

      .modal-description {
        margin: 0;
        color: rgba(255, 255, 255, 0.85);
        line-height: 1.6;
      }

      .modal-video video {
        width: 100%;
        border-radius: 1rem;
        background: #000;
        border: 2px solid rgba(255, 255, 255, 0.12);
      }

      .github-button {
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.85rem 1.25rem;
        background: var(--accent);
        border: none;
        color: #fff;
        border-radius: 0.9rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 160ms ease, box-shadow 160ms ease;
      }

      .github-button:hover {
        transform: translateY(-1px);
        box-shadow: 0 10px 20px rgba(88, 44, 131, 0.4);
      }

      .github-button img {
        width: 28px;
        height: 28px;
      }

      footer {
        text-align: center;
        padding: 3rem 1.5rem;
        color: var(--subtle);
        font-size: 0.9rem;
      }

      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
          scroll-behavior: auto !important;
        }
      }
    </style>
  </head>
  <body>
    <header class="hero">
      <div class="hero-content">
        <span class="hero-kicker">BREP</span>
        <h1>Mentored Research Experience Pathways</h1>
        <p class="hero-subtitle">
          Explore mentored learning pathways featuring hands-on modules and
          real-world applications spanning topics such as bioinformatics, machine learning, drug discovery and more.
          Click a card to watch a quick overview and continue straight
          to the GitHub repository.
        </p>
      </div>
      <div class="hero-visual" aria-hidden="true">
        <img
          src="Intros/Tglow.png"
          alt="Vibrant glow"
          class="hero-glow"
          loading="lazy"
        />
      </div>
    </header>

    <main id="pathways-root">
      <p class="status-message" id="status-message">Loading pathwaysâ€¦</p>
    </main>

    <div class="modal" id="module-modal" aria-hidden="true">
      <div class="modal-backdrop" data-dismiss="true"></div>
      <div
        class="modal-dialog"
        role="dialog"
        aria-modal="true"
        aria-labelledby="modal-title"
      >
        <button class="modal-close" type="button" aria-label="Close dialog">
          &times;
        </button>
        <div class="modal-header">
          <h3 id="modal-title"></h3>
          <p class="modal-description" id="modal-description"></p>
        </div>
        <div class="modal-video">
          <video
            id="modal-video"
            controls
            playsinline
            preload="metadata"
          ></video>
        </div>
        <button class="github-button" id="modal-github" type="button">
          <img src="Intros/GitHub_Invertocat_Logo.svg" alt="GitHub" />
          <span>Open repository</span>
        </button>
      </div>
    </div>

    <footer>
      Built for the NIGMS Sandbox Pathways.
    </footer>

    <script type="module">
      const pathwaysRoot = document.getElementById("pathways-root");
      const statusMessage = document.getElementById("status-message");
      const modal = document.getElementById("module-modal");
      const modalTitle = document.getElementById("modal-title");
      const modalDescription = document.getElementById("modal-description");
      const modalVideo = document.getElementById("modal-video");
      const githubButton = document.getElementById("modal-github");
      const modalCloseButton = modal.querySelector(".modal-close");
      const modalBackdrop = modal.querySelector(".modal-backdrop");

      const FALLBACK_CARD = "cards/blank.png";
      let currentVideoHandler = null;
      let navigatedFromModal = false;
      let currentRepoUrl = "";

      async function loadPathways() {
        try {
          const response = await fetch("./pathways.json", { cache: "no-cache" });
          if (!response.ok) {
            throw new Error("Failed to fetch pathways.");
          }
          const pathways = await response.json();
          renderPathways(Array.isArray(pathways) ? pathways : []);
        } catch (error) {
          console.error(error);
          showStatus("Unable to load pathways. Please try again later.");
        }
      }

      function showStatus(text) {
        if (statusMessage) {
          statusMessage.textContent = text;
          statusMessage.hidden = false;
        }
      }

      function hideStatus() {
        if (statusMessage) {
          statusMessage.hidden = true;
        }
      }

      function renderPathways(pathways) {
        if (!pathways.length) {
          showStatus("No pathways available yet. Check back soon.");
          return;
        }

        hideStatus();
        pathwaysRoot.innerHTML = "";

        pathways.forEach((pathway) => {
          const section = document.createElement("section");
          section.className = "pathway";

          const heading = document.createElement("h2");
          heading.textContent = pathway.name || "Untitled Pathway";
          section.appendChild(heading);

          const pathwayTags = collectPathwayTags(pathway.modules);
          if (pathwayTags.length) {
            const tagRow = document.createElement("div");
            tagRow.className = "pathway-tags";
            pathwayTags.forEach((tag) => {
              const pill = document.createElement("span");
              pill.className = "skill-pill";
              pill.textContent = tag;
              tagRow.appendChild(pill);
            });
            section.appendChild(tagRow);
          }

          const grid = document.createElement("div");
          grid.className = "module-grid";

          (pathway.modules || []).forEach((module) => {
            const card = createModuleCard(module);
            grid.appendChild(card);
          });

          if (!grid.children.length) {
            const emptyState = document.createElement("p");
            emptyState.className = "status-message";
            emptyState.textContent = "Modules coming soon.";
            grid.appendChild(emptyState);
          }

          section.appendChild(grid);
          pathwaysRoot.appendChild(section);
        });
      }

      function createModuleCard(module) {
        const wrapper = document.createElement("div");
        wrapper.className = "module-item";

        const cardButton = document.createElement("button");
        cardButton.className = "module-card";
        cardButton.type = "button";
        cardButton.setAttribute("aria-label", module.title || "Module");

        const image = document.createElement("img");
        image.src = module.cardImage || FALLBACK_CARD;
        image.alt = `${module.title || "Module"} card art`;
        cardButton.appendChild(image);

        cardButton.addEventListener("click", () => handleCardAction(module));
        wrapper.appendChild(cardButton);

        const description = getModuleDescription(module);
        if (description) {
          const descriptionEl = document.createElement("p");
          descriptionEl.className = "module-description";
          descriptionEl.textContent = description;
          wrapper.appendChild(descriptionEl);
        }

        return wrapper;
      }

      function handleCardAction(module) {
        if (!module) return;
        const repoUrl = module.repoUrl;
        const description =
          getModuleDescription(module) ||
          "Explore the repository for more details.";

        if (!module.introVideo) {
          if (repoUrl) {
            window.location.href = repoUrl;
          }
          return;
        }

        modalTitle.textContent = module.title || "Module preview";
        modalDescription.textContent = description;
        githubButton.dataset.repo = repoUrl || "";
        currentRepoUrl = repoUrl || "";
        navigatedFromModal = false;
        openModal(module.introVideo);
      }

      function openModal(videoSrc) {
        if (!videoSrc) return;

        if (currentVideoHandler) {
          modalVideo.removeEventListener("ended", currentVideoHandler);
        }

        modal.classList.add("is-visible");
        modal.setAttribute("aria-hidden", "false");
        modalVideo.src = videoSrc;
        modalVideo.currentTime = 0;

        currentVideoHandler = () => {
          if (!navigatedFromModal && currentRepoUrl) {
            navigatedFromModal = true;
            window.location.href = currentRepoUrl;
          }
        };

        modalVideo.addEventListener("ended", currentVideoHandler);
        modalVideo.play().catch(() => {
          /* Autoplay might be blocked, but controls remain available. */
        });
      }

      function closeModal() {
        if (!modal.classList.contains("is-visible")) return;
        modal.classList.remove("is-visible");
        modal.setAttribute("aria-hidden", "true");
        modalVideo.pause();
        modalVideo.removeAttribute("src");
        modalVideo.load();

        if (currentVideoHandler) {
          modalVideo.removeEventListener("ended", currentVideoHandler);
          currentVideoHandler = null;
        }
        navigatedFromModal = false;
        currentRepoUrl = "";
      }

      function collectPathwayTags(modules = []) {
        const tagSet = new Set();
        modules.forEach((module) => {
          (module?.skills || []).forEach((skill) => {
            if (typeof skill === "string") {
              const trimmed = skill.trim();
              if (trimmed) {
                tagSet.add(trimmed);
              }
            }
          });
        });
        return Array.from(tagSet);
      }

      function getModuleDescription(module) {
        if (!module) return "";
        const description =
          module.Description || module.description || module.summary || "";
        return typeof description === "string" ? description.trim() : "";
      }

      githubButton.addEventListener("click", () => {
        if (!currentRepoUrl) return;
        navigatedFromModal = true;
        window.location.href = currentRepoUrl;
      });

      modalCloseButton.addEventListener("click", closeModal);
      modalBackdrop.addEventListener("click", closeModal);

      document.addEventListener("keydown", (event) => {
        if (event.key === "Escape") {
          closeModal();
        }
      });

      loadPathways();
    </script>
  </body>
</html>
